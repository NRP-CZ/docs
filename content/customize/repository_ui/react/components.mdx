import { FileTree } from 'nextra/components';

# Components

This page covers developing and using React components across NRP repositories, including form components, search result components, and custom UI elements. For search app configuration and component overriding mechanisms, see [Component Override](/customize/repository_ui/react/overrides).

## JavaScript File Structure

Javascript source files are typically located under the `js` folder in your model's UI directory:

<FileTree>
  <FileTree.Folder name="ui" defaultOpen>
    <FileTree.Folder name="model-name" defaultOpen>
      <FileTree.Folder name="semantic-ui" defaultOpen>
        <FileTree.Folder name="js" defaultOpen>
          <FileTree.Folder name="model-name" defaultOpen>
            <FileTree.Folder name="forms" defaultOpen>
              <FileTree.File name="index.js" />
              <FileTree.File name="FormActionsContainer.jsx" />
              <FileTree.File name="FormFieldsContainer.jsx" />
            </FileTree.Folder>
            <FileTree.Folder name="search" defaultOpen>
              <FileTree.File name="index.js" />
              <FileTree.File name="ResultsGridItem.jsx" />
              <FileTree.File name="ResultsListItem.jsx" />
            </FileTree.Folder>
          </FileTree.Folder>
        </FileTree.Folder>
      </FileTree.Folder>
    </FileTree.Folder>
  </FileTree.Folder>
</FileTree>

We recommend placing your JavaScript files in the `js/model-name` folder for easier development.

## Search Result Components

Search apps display results using list or grid layouts. The most commonly customized component is the result item:

### ResultsListItem

Displays individual records in search results. This component receives a `result` object containing the record data:

```jsx filename="ui/model-name/semantic-ui/js/model-name/search/ResultsListItem.jsx"
export const ResultsListItem = ({ result }) => {
  return (
    <div className="result-item">
      <h3>{result.metadata.title}</h3>
      <p>{result.metadata.description}</p>
    </div>
  );
};
```

### ResultsGridItem

Similar to `ResultsListItem` but optimized for grid layout views.

The result object includes the full record metadata, allowing you to display any fields from your data model. See the example implementation at [nr-docs ResultsListItem](https://github.com/Narodni-repozitar/nr-docs/blob/main/ui/documents/semantic-ui/js/documents/search/ResultsListItem.jsx).

## Forms

For each model in your repository, you'll have a deposit form. After model creation, you get a basic form template located in the `forms` folder with two main containers:

- **FormActionsContainer** - Contains action buttons (save, preview, etc.), requests app for publication actions, and embargo settings
- **FormFieldsContainer** - Contains the form fields, typically organized into logical sections using accordions

Example of [FormFieldsContainer component](https://github.com/Narodni-repozitar/nr-docs/blob/main/ui/documents/semantic-ui/templates/documents/form/FormFieldsContainer.jsx).

### Field Metadata

Field metadata (labels, hints, required status) should be defined in your model YAML files, not passed as props manually. During model compilation, metadata is extracted and stored in `ui/{model-name}/models/ui.json`.

Use the `useFieldData` hook from oarepo-ui to access this metadata:

```jsx filename="ui/model-name/semantic-ui/js/model-name/forms/TextField.jsx"
import { useFieldData } from "@js/oarepo_ui/forms";
import PropTypes from "prop-types";

export const TextField = ({ fieldPath, icon, ...rest }) => {
  const { getFieldData } = useFieldData();

  return (
    <InvenioTextField
      optimized
      fieldPath={fieldPath}
      {...getFieldData({ fieldPath, icon })}
      {...rest}
    />
  );
};
```

#### Important: Rules of Hooks

The content returned by `getFieldData` is memoized. Call this function only at the top level of your component to avoid breaking React's rules of hooks:

**✅ Good - At component top level:**
```jsx
const MyForm = () => {
  const { getFieldData } = useFieldData();
  const field1Metadata = getFieldData({ fieldPath: "metadata.name" });
  const field2Metadata = getFieldData({ fieldPath: "metadata.value" });

  return /* ... */;
};
```

**❌ Bad - Inside loops or conditionals:**
```jsx
// This breaks rules of hooks as hook calls vary between renders
{items.map((item) => (
  <Field key={item.id} metadata={getFieldData({ fieldPath: item.fieldPath })} />
))}
```

### Available Form Components

#### Basic Text Input

```jsx
import { TextField } from "@js/oarepo_ui/forms";

<TextField fieldPath="metadata.title" />
```

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `fieldPath` | string | (required) | Path to the field in dot notation |
| `fieldRepresentation` | string | "full" | "full", "compact", or "text" |
| `icon` | string | "pencil" | Icon to display |
| `...rest` | any | - | Passed to InvenioTextField |

Automatically applies field metadata, XSS protection, and Formik integration.

#### Rich Text Editor

Uses TinyMCE for formatted text input:

```jsx
import { RichInputField } from "react-invenio-forms";
import { OarepoRichEditor } from "@js/oarepo_ui/forms";

<RichInputField
  fieldPath="metadata.description"
  label={i18next.t("Description")}
  editor={<OarepoRichEditor />}
/>
```

**Note:** Unlike most components, `RichInputField` requires explicit field metadata props.

#### Date Pickers (EDTF)

Support for Extended Date/Time Format with precision options:

```jsx
import { EDTFSingleDatePickerField, EDTFDateRangePickerField } from "@js/oarepo_ui/forms";

// Single date
<EDTFSingleDatePickerField fieldPath="metadata.publicationDate" />

// Date range
<EDTFDateRangePickerField fieldPath="metadata.eventDateRange" />
```

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `fieldPath` | string | (required) | Path to the field |
| `label` | string\|node | (from model) | Custom label |
| `icon` | string | "calendar" | Icon to display |
| `required` | boolean | (from model) | Required status |
| `datePickerPropsOverrides` | object | {} | Override picker behavior |

#### Multilingual Inputs

For content in multiple languages:

```jsx
import { I18nTextInputField, I18nRichInputField } from "@js/oarepo_ui/forms";

// Plain text
<I18nTextInputField fieldPath="metadata.multilingualTitle" />

// Rich text
<I18nRichInputField fieldPath="metadata.multilingualDescription" />
```

Data format:
```json filename="multilingual_field_data.json"
{
  "lang": "en",
  "value": "Title in English"
}
```

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `fieldPath` | string | (required) | Path to the field |
| `lngFieldWidth` | number | 3 | Language selector width (1-16) |
| `editorConfig` | object | undefined | Rich editor config |

#### Vocabulary Selection

For controlled terminology dropdowns:

```jsx
import {
  LocalVocabularySelectField,
  VocabularySelectField,
} from "@js/oarepo_vocabularies/form";

// Pre-loaded local vocabulary
<LocalVocabularySelectField
  fieldPath="metadata.resourceType"
  optionsListName="resource-types"
/>

// API-loaded vocabulary
<VocabularySelectField
  fieldPath="metadata.subjects"
  type="subjects"
  multiple={true}
/>
```

**LocalVocabularySelectField** - Best for small vocabularies loaded all at once:
| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `fieldPath` | string | (required) | Path to the field |
| `optionsListName` | string | (required) | Vocabulary name in formConfig |
| `multiple` | boolean | false | Allow multiple selections |
| `showLeafsOnly` | boolean | false | Show only leaf nodes in hierarchies |
| `clearable` | boolean | true | Allow clearing selection |

**VocabularySelectField** - For large vocabularies loaded via API:
| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `fieldPath` | string | (required) | Path to the field |
| `type` | string | (required) | Vocabulary type (API endpoint) |
| `multiple` | boolean | false | Allow multiple selections |

#### Complex Nested Fields

For arrays of nested fields:

```jsx filename="ui/model-name/semantic-ui/js/model-name/forms/EventsField.jsx"
import React from "react";
import { ArrayField, GroupField } from "react-invenio-forms";
import { LocalVocabularySelectField } from "@js/oarepo_vocabularies";
import { TextField, StringArrayField, EDTFDateRangePickerField } from "@js/oarepo_ui/forms";
import useFormikContext from "formik";

export const EventsField = ({ fieldPath }) => {
  const { getFieldData } = useFieldData();

  return (
    <ArrayField
      addButtonLabel="Add event"
      fieldPath={fieldPath}
      {...getFieldData({ fieldPath, fieldRepresentation: "text" })}
    >
      {({ indexPath }) => {
        const prefix = `${fieldPath}.${indexPath}`;
        return (
          <>
            <TextField fieldPath={`${prefix}.eventName`} />
            <EDTFDateRangePickerField fieldPath={`${prefix}.eventDate`} />
            <GroupField>
              <TextField fieldPath={`${prefix}.location.place`} />
              <LocalVocabularySelectField
                fieldPath={`${prefix}.location.country`}
                optionsListName="countries"
              />
            </GroupField>
          </>
        );
      }}
    </ArrayField>
  );
};
```

#### Fields in Modal

For very complex fields, consider using a modal for better UX. This requires an internal Formik instance to manage the modal form.

Example: [Creatibutors field](https://github.com/inveniosoftware/invenio-rdm-records/tree/19e5e080b75a5c9ca5688e02e8dc378e3d209cfb/invenio_rdm_records/assets/semantic-ui/js/invenio_rdm_records/src/deposit/fields/CreatibutorsField) from RDM.

**Trade-offs:**
- Use modals only when truly necessary
- Requires data conversion between main form and modal
- Can be challenging with deeply nested data

## Related Resources

- [Component Override](/customize/repository_ui/react/overrides) - Customizing existing components
- [State Management](/customize/repository_ui/react/state_management) - Formik and Formik hooks
- [react-invenio-forms](https://github.com/inveniosoftware/react-invenio-forms) - Base form components
- [oarepo-ui (form components)](https://github.com/oarepo/oarepo-ui/tree/main/oarepo_ui/theme/assets/semantic-ui/js/oarepo_ui/forms) - Custom form components
- [oarepo-vocabularies](https://github.com/oarepo/oarepo-vocabularies) - Vocabulary selection components
