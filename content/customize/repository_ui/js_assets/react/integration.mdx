import { Callout, FileTree, Cards, Steps } from 'nextra/components';
import { Card } from "@/components/card";

# React apps Integration

This page covers how to integrate React components into your repository, including configuring entry points, building bundles, and mounting components in Jinja/JinjaX templates.

<Callout type="info">
For an overview of the React architecture in NRP repositories, see the [Overview](/customize/repository_ui/js_assets/react) page.
</Callout>

## Repository-Level Component Structure

Repository-wide React components are typically placed in `ui/components/`:

<FileTree>
  <FileTree.Folder name="ui/components" defaultOpen>
    <FileTree.Folder name="semantic-ui" defaultOpen>
      <FileTree.Folder name="js" defaultOpen>
        <FileTree.Folder name="feature-a" defaultOpen>
          <FileTree.File name="index.js" />
          <FileTree.File name="Component.jsx" />
          <FileTree.File name="component-util.js" />
        </FileTree.Folder>
        <FileTree.Folder name="feature-b" defaultOpen>
          <FileTree.File name="index.js" />
        </FileTree.Folder>
        <FileTree.File name="home-page-search.js" />
        <FileTree.File name="custom-components.js" />
      </FileTree.Folder>
      <FileTree.Folder name="templates" />
    </FileTree.Folder>
    <FileTree.Folder name="templates" />
    <FileTree.File name="webpack.py" />
  </FileTree.Folder>
</FileTree>

## Creating a New Component

<Steps>

### Add Mount Point to Template

First, declare a DOM mount point in your Jinja template where the React component will be rendered:

```html filename="ui/components/templates/home.jinja"
<div id="welcome-banner" data-user='{{ user | tojson }}'></div>
```

The `id` attribute is used by the JavaScript entry point to locate the element, and `data-*` attributes pass server-side data to the React component.

### Create the Component

Create a simple React component that displays a welcome message:

```jsx filename="ui/components/semantic-ui/js/WelcomeBanner/WelcomeBanner.js"
import React from "react";

export function WelcomeBanner({ user }) {
  return (
    <div className="ui message info">
      <i className="info circle icon"></i>
      <div className="content">
        <div className="header">
          Welcome, {user.name || "Guest"}!
        </div>
        <p>This is your custom React component.</p>
      </div>
    </div>
  );
}
```

### Create the Entry Point

Create an entry point that mounts your component to the DOM:

```jsx filename="ui/components/semantic-ui/js/WelcomeBanner/index.js"
import ReactDOM from "react-dom";
import React from "react";
import { WelcomeBanner } from "./WelcomeBanner";

function renderWelcomeBanner() {
  const element = document.getElementById("welcome-banner");
  if (element) {
    const user = JSON.parse(element.dataset.user || "{}");
    ReactDOM.render(
      <WelcomeBanner user={user} />,
      element
    );
  }
}

// Initialize when DOM is ready
if (document.readyState === "loading") {
  document.addEventListener("DOMContentLoaded", renderWelcomeBanner);
} else {
  renderWelcomeBanner();
}
```

### Configure Entry Points in webpack.py

Add the entry point to your webpack configuration:

```python filename="ui/components/webpack.py"
from invenio_assets.webpack import WebpackThemeBundle

theme = WebpackThemeBundle(
    __name__,
    ".",
    default="semantic-ui",
    themes={
        "semantic-ui": dict(
            entry={
                "welcome_banner": "./js/WelcomeBanner/index.js",
            },
            aliases={},
            dependencies={},
            devDependencies={},
        )
    },
)
```

### Include Bundle in Template

Include the bundled JavaScript in your Jinja template:

```jinja filename="ui/components/templates/home.jinja"{4}
<div id="welcome-banner" data-user='{{ user | tojson }}'></div>

{%- block javascript %}
{{ webpack['welcome_banner.js'] }}
{%- endblock %}
```

<Callout type="info">
**Extending templates with inheritance:** When your template extends another page that also defines a `javascript` block, use `{{ super() }}` to preserve the parent's JavaScript bundles:

```jinja
{%- block javascript %}
{{ super() }}
{{ webpack['welcome_banner.js'] }}
{%- endblock %}
```

This ensures that any JavaScript bundles defined in the parent template (such as search UI, theme scripts, etc.) are still loaded in addition to your custom bundle.
</Callout>

### Rebuild JavaScript Assets

After adding or modifying entry points, rebuild the JavaScript bundles:

```bash
./run.sh invenio webpack clean create
./run.sh invenio webpack install
```

</Steps>

## Data Passing with data-* Attributes

Pass server-side data to React components using HTML data attributes. The server-side data comes from the template context prepared by UI resource view methods:

<Callout type="info">
UI resource views (see [UI Resource Views](/customize/repository_ui/resources)) prepare context data that gets passed to templates. You can pass any available context variable to your React component using data attributes.
</Callout>

The `tojson` filter serializes Python objects to JSON:

```jinja filename="ui/components/templates/home.jinja"
<div id="welcome-banner"
     data-user-name="{{ user.name }}"
     data-user-email="{{ user.email }}"
     data-settings='{{ settings | tojson }}'>
</div>


{%- block javascript %}
{{ webpack['welcome_banner.js'] }}
{%- endblock %}
```

Use `data-*` attributes for simple values and `| tojson` for complex objects like nested data structures or arrays.

## Multiple Apps on One Page

You can embed multiple React apps in a single page. Each component has its own DOM mount point and entry point:

```jinja filename="ui/components/templates/home.jinja"
<div id="welcome-banner" data-user='{{ user | tojson }}'></div>
<div id="recent-items" data-items='{{ recent_items | tojson }}'></div>


{%- block javascript %}
{{ webpack['welcome_banner.js'] }}
{{ webpack['recent_items.js'] }}
{%- endblock %}
```

Each entry point independently renders to its designated DOM element.

<Callout type="warning">
Avoid mounting multiple apps to the same DOM element, as this causes state conflicts.
</Callout>

## Related Resources

<Cards>
  <Card
    title="Components"
    href="/customize/repository_ui/js_assets/react/components"
  >
    Available form and search components
  </Card>
  <Card
    title="Component Override"
    href="/customize/repository_ui/js_assets/react/overrides"
  >
    Component customization patterns
  </Card>
  <Card
    title="State Management"
    href="/customize/repository_ui/js_assets/react/state_management"
  >
    Managing React state
  </Card>
  <Card
    title="Webpack Configuration"
    href="/customize/repository_ui/webpack"
  >
    Entry point and bundle configuration
  </Card>
  <Card
    title="JinjaX Components"
    href="/customize/repository_ui/templating/jinjax"
  >
    Template component system
  </Card>
</Cards>
